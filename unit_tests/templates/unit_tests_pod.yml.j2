apiVersion: v1
kind: Pod
metadata:
  name: tower-unit-tests-{{ BUILD_ID }}
  labels:
    name: tower-unit-tests-{{ BUILD_ID }}
spec:
  containers:
    - name: tower-unit-tests-{{ BUILD_ID }}
      image: gcr.io/ansible-tower-engineering/tools_tower_unit:latest
      imagePullPolicy: Always

    - name: jenkins-slave-{{ BUILD_ID }}
      image: gcr.io/ansible-tower-engineering/jenkins-jnlp-docker-ansible:latest
      imagePullPolicy: Always
      command:
        - "java -jar slave.jar -jnlpUrl {{ jenkins_uri }}/computer/test-slave/slave-agent.jnlp -jnlpCredentials {{ lookup('env', 'JENKINS_LOGIN_USER') }}:{{ lookup('env', 'JENKINS_LOGIN_PASSWORD') }}"

